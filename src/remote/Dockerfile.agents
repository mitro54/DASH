FROM ubuntu:24.04

# Install cross-compilers
RUN apt-get update && apt-get install -y \
    build-essential \
    g++-aarch64-linux-gnu \
    g++-arm-linux-gnueabihf \
    python3

# Copy Source
COPY src/remote/agent.cpp /src/agent.cpp
COPY include/core/file_analyzer.hpp /src/include/core/file_analyzer.hpp

WORKDIR /build

# 1. Build x86_64 (Standard Server)
RUN g++ -static -O3 -std=c++20 -I/src/include /src/agent.cpp -o agent_x86_64

# 2. Build aarch64 (Raspberry Pi 3/4/5, AWS Graviton)
RUN aarch64-linux-gnu-g++ -static -O3 -std=c++20 -I/src/include /src/agent.cpp -o agent_aarch64

# 3. Build armv7 (Older Raspberry Pi)
RUN arm-linux-gnueabihf-g++ -static -O3 -std=c++20 -I/src/include /src/agent.cpp -o agent_armv7

# If you wanted to extract these, you would run this container and copy /build/*
# Or use a script to convert them to C++ header (dais_agents.hpp)
